=== 2019-12-16 ===
Camera binning - use current
Events - Camera events - ON (edit)
Repeat T - 1000 times (edit)
	-Move channel 505nm (10-150 msec) (Live; Move to; Acquire; Edit; Insert; Delete; Change Channel)
	-Snap frame (Edit; insert; delete)
	-Move channel 455nm (10-150 msec)  (Live; Move to; Acquire; Edit; Insert; Delete; Change Channel)
	-Snap frame (Edit; insert; delete)
	-Move channel 590nm (10-150 msec) (Live; Move to; Acquire; Edit; Insert; Delete; Change Channel)
	-Snap frame (Edit; insert; delete)
-Close
-OnLineChat (Edit; insert; delete)
-End T"

=== 2020-03-03 ===
Список того, что мы отметили при работе в программе.

График:
- Первая точка при построении графика выбивается, если активно несколько диодов. Первая точка не выбивается, если идет запись только с одного диода.
Не хватает:
- Возможности ставить временные метки на графике;
- Масштабирование осей графика (возможность выставлять пределы);
- Возможность выставлять на графике масштабную линейку
- Возможность строить график не только для первого канала.
- Возможность сохранения графика.

ROI:
- Добавить круг;
- Возможность удалять и перемещать ROI (при нажатии на правую кнопку мыши появляется меню управления ROI, но удаление не срабатывает).

Экспозиция и LedOn:
- Если экспозиция отличается от времени включенного состояния диода меньше, чем на 25 мсек, то диоды попадают на чужой канал(??) Фотографии начинают менять яркость при каждой последовательности включения диодов (экспозиция при этом меньше, чем время включенного состояния диода). Можно ли скомпенсировать эти временные смещения, чтобы экспозицию и LedOn делать одинаковыми по длительности?

- Возможность сохранения настроек съемки.

=== 2020-07-06 ===
Исправлена процедура вывода светимости ROI в текстовые файлы.

=== 2020-09-13 ===
Введена возможность рисования ROI произвольных форм.

=== 2020-12-13 ===
Проследить за принудительной установкой PixelFormat (pf8bit), т.к. загрузк ранее сохранённых изображений меняет этот параметр

=== 2020-12-15 ===
1) Изменён формат сохранения изображений (8-bit gray)
2) Изменён способ рисования. Вместо Pixels используется ScanLine (ускорение прорисовки)
3) Введена возможность настройки видимой яркости изображений

=== 2020-12-17 ===
1) Ведена загрузка изображений для пересчёта через буферный bitmap
2) Проверить стабильность работы при загрузке для пересчёта изображений разного формата (24 бита RGB и 8 бит gray)

=== 2021-03-16 ===
1) Внести задержку между командой включения диодов и началом экспозиции на камере для устранения эффекта переходного процесса включения диодов.

=== 2021-04-14 ===
1) Попытаться записать динамику включения светодиодов для определения времени переходного процесса.
2) Попробовать включение при разых целевых интенсивностях.


=== 2021-07-10 ===
1) Найти наиболее медленное звено в цепи команд управления диодами и камерой

=== 2021-07-23 ===
1) Обнаружена проблема битности сохраняемого изображения. Почему 8бит? Надо 16 или выше!
2) Добавить возможность задания различной длительности свечения для каждого диода независимо. Соответственно, нужно подстраивать экспозицию камеры под меняющуюся длительность свечения диода
3) Добавить возможность редактирования ROI во время записи. Как вариант, можно реализовать это через паузу в записи
4) Попытаться встроить модуль автоматического отслеживая сдвигов и поворотов ROI во время записи и постообработки записанных изображений.

Работа с растром на низком уровне для начинающих:
https://habr.com/ru/post/196578/

Прямой доступ к пикселям Bitmap:
https://ip76.ru/bitmap-pixel-post/

Захват экрана, использование переменных ОС:
https://www.sql.ru/forum/1323877/sozdanie-snimka-ekrana-v-formate-bmp-s-glubinoy-cveta-16bit


=== 2021-09-09 ===
1) В режиме Live а) реализовать возможность увеличения окна с изображением, б) проверить работу цифрового усиления, в) ускорить отрисовку кадров

=== 2021-09-20 ===
1) реализовать рисование графика отношения светимостей (сделано); сделать процесс масштабирования графиков более интуитивным
2) рисовать шкалу времён в фреймах; дать возможность выбора шкалы. (сделано)
3) реализовать режим увеличения окна со снимками в трёх светах. Увеличение пока возможно только в режиме Live

=== 2021-09-29 ===
1) (важно!) вернуть сохранение-загрузку параметров эксперимента. (сделано!)

=== 2022-02-03 ===
1) экспорт данные в текст идёт без разделения табуляцией (исправлено)
2) возможность растягивания окна со снимками
3) адекватно отображать 16-битные изображения


=== 2022-09-01 ===
1) не работает запись с одним и двумя каналами освещения. Видимо, связано с жёсткой формулой вычисления соотношений интенсивностей. Установлена защита от обращения к несуществующим данным.
2) проблема загрузки большого количества изображений при пересчёте (появляется сообщение "out of memory"). Обнаружена ошиба внутренней функции, формирующей список файлов: при большом количестве файлов, искажается начальная часть полного пути; далее программа не может найти эти файлы. (исправлено)
3) организовать сохранение ROI
4) организовать введение текстовых меток по ходу эксперимента. Сделано частично: метки добавляются только к последнему записанному сигналу.
5) организовать сохранение и отображение внешних синхросигналов (TTL).
6) (!)дать возможность вводить формулу вычисления соотношений интенсивностей.

=== 2022-09-16 ===
1) Обнаружен out of memory при повторных нажатиях кнопки Strart в режиме пересчёта яркостей по сохранённым изображениям. Перед каждым нажатием менял выбранные для рисования каналы.
2) Ввести управляемую пользователем задержку между включением диода и включением экспозиции
от Лены:
1. LedOn: в отличие от остальных ячеек, значения LedOn неудобно редактировать, а именно при попытке ввести новые значения автоматически вставляются значения экспозиции, выставленные в соседней колонке, а вводимые цифры (за исключением первой) добавляются впереди. Например, если экспозиция 30, то при попытке ввести значение LedOn 15 введется 530. Эта проблема некритичная: при выставлении курсора в нужное место, возможно отредактировать значения. Особенно удобно стало с функцией сохранения настроек. Мы теперь очень редко вводим параметры съемки вручную.
2. Выделение ROI на увеличенном изображении. В данных условиях ROI выделяется в стороне от желаемой области. Исправлено.
3. Заметки к графикам не сохраняются. Было бы удобно сохранять их в текстовом документе напротив номера фрейма в дополнительной колонке. Сделано.

=== 2022-10-01 ===
1) Snap не работал. Исправлено.
2) Было двойное деление на предельную яркость при вычислении относительной яркости. Исправлено.
3) Обнаружен дефект перерисовки ROI после удаления старых ROI: при динамической отрисовки проступают удалённые ROI, вероятно, из-за недоочищенного двойного буфера канвы.
4) Сделал генерацию имён файло для хранения пересчитанных яркостей. Сделано.
5) Обнаружено удлиннение периода свечения первого диода. Может ли это повлиять на значение интенсивности?

=== 2022-10-08 ===
1) Обнаружена ошибка приписания времён значениям отношения светимостей при пересчёте. Исправлено.
2) Доделаны вставки заметок по ходу эксперимента. В конце записи, тектсы заметок сохраняются в файл со светимостями ROI.
3) При старте записи изображение менят размер на исходный. Надо ли удерживать изменённый?
4) Желательно сделать добавление тэгов к произвольному сигналу (спросить у экспериментаторов).
5) Отключена защита от несогласованных длительностей экспозиции и времени свечения диодов.

=== 2022-10-15 ===
1) Изменил порядок команд в главном цикле измерения. Отключил проверки реакльного напряжения на диодах.
2) Включить в тесты программы проверку на работоспособность при разных длительностях свечения диодов и разных длительностях экспозиций.

=== 2022-10-22 ===
1) Убрал паузу в цикле захвата изображений в режиме Live.
2) Минимизировал время получения изображения в режиме Live в том числе за счёт выбора kineticCycTm в зависимости от времени экспозиции: отображение идёт с минимальной задержкой. Время экспозиции задаётся как максимальное время экспозиции среди всех диодов. Возможно, с этим параметром связаны неучтённые задержки в режиме сбора данных.
3) Не правильно выставляется высока окна с изображениями: низ зарезается.
4) Убрал лишнее отключение реакции на изменение размера формы Graphs
5) Отключил двойной буфер изображений (OpenGL). Выглядит лучше.

=== 2022-12-26 ===
1) Изменил процедуру вычисления и отрисовки отношений светимости: усилил защиту от попытки получить несуществующие данные

=== 2023-05-16 ===
1) Введена возможность менять период съёмки (FramePre) по ходу эксперимента.
2) Активировано изменение задержки между включением диода и сбором на камере.
3) Добавлено сохранение абсолютного времени (от начала суток) в формате ЧЧ:ММ:СС

=== 2023-05-20 ===
1) Изменил способ задания имени файла: отметка времени имеет стандартную точно (4 знака после запятой).
  Необходимо проверить алгоритм обратного считывания отметки времени из имени файла.
2) Исправлена ошибка чтения большого количества файлов (не было команды TIFFClose).
3) Добавлена возможность включения и выключения графиков в любой момент времени.
  Необходимо проверить работоспособность, в том числе во время сбора данных.

=== 2023-05-27 ===
1) Исправлена ошибка назначения базового имени (baseName) при пересчёте
2) Добавлена суффикс raw для текстовых файлов, формируемых сразу после окончания сбора данных, т.к. только в этих файлах хранятся отметки, введённые экспериментатором.
3) Возникла идея отказаться от задания времени включенного состояния диода. Время свечения полностью определяется необходимым временем экспозиции на ПЗС-матрицу камеры. Надо найти способ следить за сигналом камеры об окончании экспозиции, либо включить счётчик длительностью в экспозицию, но послед сигнала о начале сбора.

=== 2023-05-30 ===
1) Для режима 5 - "run till abort" установлено acqParams.kineticCycTm = 0;//kinetic cycle time (seconds)
2) Похоже камера может циклически переключаться между предзагруженными экспозициями (команда SetRingExposureTimes). Т.е. не нужно тратить время на смену экспозиций.
3) Попробовать WaitForAcquisition для отслеживания окончания экспозиции.

=== 2023-06-10 ===
1) Теперь экспозиции задаются циклическим массивом (функция SetRingExposureTimes).
2) Ошика "Software trigger sending error" по команде SendSoftwareTrigger вызывалась попыткой запустить сбор очередного кадра до окончания предыдущей экспозиции. Исправлено введением команды WaitForAcquisition(), которая теперь будет частью идеологии привязки свечения диода исключително к необходимой длительности экспозиции (т.е. пользователь не будет иметь возможности задавать время включенного состояния диода).
3) Также обнаружена наиболее вероятная причина повышения яркости отдельных кадров (одиночные пики яркости в экспериментах): видимо, следующий диод мог включаться до окончания предыдущей экспозиции.
4) Убрал возможность менять длительность свечения диодов. Теперь длительность определяется только временем экспозции, т.е. минимизируется световая нагрузка на препарат.

=== 2023-10-21 ===
1) Обнаружены выпадения файлов со снимками препарата: в текстовом файле, полученно сразу после эксперимента есть данные о светимостях на всех каналах для каждого фрейма, однако оказывается, что некоторые файлы не существуют. Вероятно, происходит сбой сохранения tif-файлов.
2) Из-за проблемы пропадающих файлов надо обязательно следить за тем, чтобы при последующих пересчётах отношения (LED1/LED4, LED3/LED4) считались по соответствующим по времени светимостям.
3) Наблюдаются скачки вверх отношений яркостей, которым соответствуют кратковременные (может, в течение нескольких фреймов) падения яркости на разных диодах. Т.е. искать нужно не причины повышения яркости, а причины понижения.
4) Похоже есть проблемы с удалением ROI: видны старые ROI при отрисовке, также появлются данные светимости для старых ROI.

